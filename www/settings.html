<ons-page id="settings">
    <ons-list>
        <ons-list-header>MQTT settings</ons-list-header>
        <ons-list-item class="input-items">
            <div class="left">
                host
            </div>
            <label class="center">
                <ons-input id="settings-host" float placeholder="mqtt hostname"></ons-input>
            </label>
        </ons-list-item>
        <ons-list-item class="input-items">
            <div class="left">
                port
            </div>
            <label class="center">
                <ons-input id="settings-port" float placeholder="mqtt port"></ons-input>
            </label>
        </ons-list-item>
        <ons-list-item class="input-items">
            <div class="left">
                clientId
            </div>
            <label class="center">
                <ons-input id="settings-clientid" float placeholder="mqtt clientid"></ons-input>
            </label>
        </ons-list-item>
        <ons-list-item class="input-items">
            <div class="left">
                topic
            </div>
            <label class="center">
                <ons-input id="settings-topic" float placeholder="mqtt topic"></ons-input>
            </label>
        </ons-list-item>
        <ons-list-item>
            <ons-button class="savebutton">Save</ons-button>
        </ons-list-item>
        <ons-list-header>Debug commands</ons-list-header>
        <ons-list-item>
            <ons-button id="eraseMqtt">erase saved mqtt settings</ons-button>
        </ons-list-item>
        <ons-list-item>
            <ons-button id="eraseUser">erase saved user</ons-button>
        </ons-list-item>
    </ons-list>
    <script>
        ons.getScriptPage().onShow = function () {
            mqttSettings = app.loadSettings();

            document.getElementById('settings-host').value = mqttSettings.host;
            document.getElementById('settings-port').value = mqttSettings.port;
            document.getElementById('settings-clientid').value = mqttSettings.clientid;
            document.getElementById('settings-topic').value = mqttSettings.topic;

            $('#settings').on('click', '.savebutton', function (e) {
                var newSettings = {
                    host: $('#settings-host').val(),
                    port: $('#settings-port').val(),
                    clientid: $('#settings-clientid').val(),
                    topic: $('#settings-topic').val()
                };

                if (app.validateSettings(newSettings)) {
                    app.saveSettings(newSettings);
                    ons.notification.alert({
                        message: 'New settings saved.',
                        title: 'Settings'
                    });
                } else {
                    ons.notification.alert({
                        message: 'Please check your settings.',
                        title: 'Error'
                    });
                }
            });

            $('#settings').on('click', '#eraseMqtt', function (e) {
                if (storage.removeItem('mqttSettings')) {
                    ons.notification.alert({
                        message: 'Settings succesfully removed.',
                        title: 'Settings'
                    });
                }
            });
            $('#settings').on('click', '#eraseUser', function (e) {
                if (storage.removeItem('user')) {
                    ons.notification.alert({
                        message: 'User succesfully removed.',
                        title: 'User'
                    });
                }
            });
        }
    </script>
</ons-page>