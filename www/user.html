<ons-page id="user">
    <div class="logged-out" style="display: none;">
        <ons-card>
            <p>You need an acount at www.xxx.be. After creating your profile, you will receive a unique token.</p>
            <p>Please fill out that token here.</p>
        </ons-card>
        <ons-list>
            <ons-list-header>User</ons-list-header>
            <ons-list-item class="input-items">
                <div class="left">
                    token
                </div>
                <label class="center">
                    <ons-input id="user-token" float placeholder="your token"></ons-input>
                </label>
            </ons-list-item>

            <ons-list-item>
                <ons-button class="savebutton">Log in</ons-button>
            </ons-list-item>
        </ons-list>
    </div>
    <div class="logged-in" style="display: none;">
        <ons-card>
            <p>Welcome
                <span class="username"></span>.</p>
            <p>You can use the app now.</p>
            <ons-button id="logout">log out</ons-button>
        </ons-card>
    </div>
    <script>
        ons.getScriptPage().onShow = function () {
            app.checkIfUserLoggedIn();

            $('#user').on('click', '.savebutton', function (e) {
                console.log('savebutton clicked');
                var newUser = {
                    token: $('#user-token').val()
                };

                newUser = app.validateUser(newUser)

                if (newUser) {
                    app.saveUser(newUser);
                    ons.notification.alert({
                        message: 'You have succesfully logged in.',
                        title: 'User'
                    });
                    // XXX redirect to device page
                } else {
                    ons.notification.alert({
                        message: 'Please check your user token.',
                        title: 'Token not correct'
                    });
                }

                app.checkIfUserLoggedIn();
            });

            $('#user').on('click', '#logout', function (e) {
                if (storage.removeItem('user')) {
                    ons.notification.alert({
                        message: 'You have succesfully logged out.',
                        title: 'User'
                    });
                }
                app.checkIfUserLoggedIn();
            });
        }
    </script>
</ons-page>